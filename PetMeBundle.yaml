openapi: 3.0.0
info:
  title: PetMeAPI
  description: Especificación de la API que expone los servicios provistos por el servidor de PetMe
  version: 0.3.0
  contact:
    name: Edson Manuel Carballo Vera
    email: edsonmanuelcarballovera@gmail.com
    url: 'https://twitter.com/EdsonManuelVera'
servers:
  - description: Producción
    url: 'http://amigosinformaticos.ddns.net:42070'
paths:
  /login:
    description: Crea una nueva sesión del usuario en el sistema
    post:
      summary: Endpoint para que los usuarios puedan iniciar sesión en el servidor
      tags:
        - Usuario general
      operationId: login
      requestBody:
        description: Credenciales para iniciar sesion
        content:
          application/json:
            schema:
              properties:
                email:
                  type: string
                  minLength: 5
                  maxLength: 320
                  example: correo@correo.com
                password:
                  type: string
                  minLength: 8
                  maxLength: 100
                  example: contraChida
        required: true
      responses:
        '200':
          description: El usuario ha iniciado sesion exitosamente
          content:
            application/json:
              schema:
                properties:
                  token:
                    description: Token identificador del usuario
                    type: string
                  id:
                    description: id del comensal
                    type: integer
                    format: int32
                    minimum: 1
                    maximum: 999
                    example: 24
        '400':
          description: Peticion erronea o malformada
        '404':
          description: El usuario no se encuentra registrado
        '406':
          description: La solicitud no es aceptable por falta de valores
  /adoptantes:
    description: Catalogo de adoptantes registrados
    get:
      summary: Retorna los adoptantes que coincidan con algun parametro
      tags:
        - Adoptante
      operationId: obtenerAdoptantes
      parameters:
        - name: nombre
          description: Nombre del adoptante
          in: query
          schema:
            type: string
            minLength: 3
            maxLength: 40
          required: false
        - name: apellido_paterno
          description: Apellido paterno del adoptante
          in: query
          schema:
            type: string
            minLength: 3
            maxLength: 35
          required: false
        - name: apellido_materno
          description: Apellido materno del adoptante
          in: query
          schema:
            type: string
            minLength: 3
            maxLength: 35
          required: false
        - name: email
          description: Correo electronico del adoptante
          in: query
          schema:
            type: string
            minLength: 5
            maxLength: 320
          required: false
      responses:
        '200':
          description: Se ha encontrado por lo menos un adoptante que coincide con algun criterio
          content:
            application/json:
              schema:
                type: array
                description: Arreglo de adoptantes
                items:
                  anyOf:
                    - $ref: '#/paths/~1adoptantes/post/requestBody/content/application~1json/schema'
                    - $ref: '#/paths/~1adoptantes/post/requestBody/content/application~1json/schema'
                    - $ref: '#/paths/~1adoptantes/post/requestBody/content/application~1json/schema'
        '204':
          description: No se ha encontrado ninguna coincidencia
        '400':
          description: Peticion erronea o malformada
    post:
      summary: Registra un nuevo adoptante
      tags:
        - Adoptante
        - Registrar
      operationId: registrarAdoptante
      requestBody:
        description: Informacion del nuevo adoptante
        content:
          application/json:
            schema:
              allOf:
                - type: object
                  description: Una persona
                  required:
                    - nombre
                  properties:
                    id_persona:
                      description: Identificador numerico del persona
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 999
                      example: 34
                    nombre:
                      description: El nombre de la persona
                      type: string
                      minLength: 3
                      maxLength: 40
                      example: Miguel Joaquin
                    apellido_paterno:
                      description: El apellido paterno de la persona
                      type: string
                      minLength: 3
                      maxLength: 35
                      example: Perez
                    apellido_materno:
                      description: El apellido materno de la persona
                      type: string
                      minLength: 3
                      maxLength: 35
                      example: Arriaga
                    telefono:
                      $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema/properties/telefono'
                    email:
                      $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema/properties/email'
                    password:
                      description: Contraseña de la persona
                      type: string
                      minLength: 8
                      maxLength: 32
                      example: contraChida
                    fecha_nacimiento:
                      description: Fecha de nacimiento de la persona
                      type: string
                      format: date
                      example: 1999-07-19T00:00:00.000Z
                    sexo:
                      description: Sexo de la persona
                      type: boolean
                      example: 0
                    localidad:
                      $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema/properties/localidad'
                    estado:
                      $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema/properties/estado'
              type: object
              description: Un adoptante
              properties:
                vivienda:
                  type: object
                  description: Informacion de una vivienda
                  required:
                    - id_vivienda
                  properties:
                    id_vivienda:
                      description: Identificador de la vivienda
                      type: integer
                      format: int32
                      minimum: 0
                      maximum: 999
                      example: 435
                    tipo:
                      description: Tipo de vivienda
                      type: string
                      minLength: 3
                      maxLength: 100
                      example: Un ranchito
        required: true
      responses:
        '201':
          description: Adoptante registrado
          content:
            application/json:
              schema:
                $ref: '#/paths/~1adoptantes/post/requestBody/content/application~1json/schema'
          links:
            ObtenerInfoAdoptante:
              operationId: obtenerAdoptante
              description: El id devuelto en esta operacion se usa para obtener la informacion del adoptante
              parameters:
                id_adoptante: $response.body#/id_persona
        '400':
          description: Peticion erronea o malformada
        '409':
          description: El adoptante ya ha sido registrado previamente
  '/adoptantes/{id_adoptante}':
    description: Un adoptante identificado por su id
    get:
      summary: Retorna la informacion del comensal seleccionado
      tags:
        - Adoptante
      operationId: obtenerAdoptante
      parameters:
        - name: id_adoptante
          description: Id del adoptante cuya informacion se desea recuperar
          in: path
          schema:
            type: integer
            minimum: 1
            maximum: 999
          required: true
        - name: Token
          description: Token identificador del adoptante loggeado
          in: header
          schema:
            type: string
          required: true
      requestBody:
        description: Datos solicitados del adoptante
        content:
          application/json:
            schema:
              type: array
              description: Arreglo con los nombres de las propiedades que se desean retornar
              items:
                type: string
              example:
                - id_adoptante
                - nombre
      responses:
        '200':
          description: Se ha retornado la informacion correspondiente al adoptante
          content:
            application/json:
              schema:
                $ref: '#/paths/~1adoptantes/post/requestBody/content/application~1json/schema'
        '400':
          description: Peticion erronea o malformada
        '401':
          description: Usuario no autenticado
        '404':
          description: El adoptante buscado no se encuentra registrado
        '419':
          description: La sesion del usuario ha expirado
    post:
      summary: Actualiza la informacion de un adoptante identificado por su id
      tags:
        - Adoptante
        - Actualizar
      operationId: actualizarAdoptante
      parameters:
        - name: id_adoptante
          description: Id del adoptante cuya informacion se desea actualizar
          in: path
          schema:
            type: integer
            minimum: 1
            maximum: 999
          required: true
        - name: Token
          description: Token identificador del adoptante loggeado
          in: header
          schema:
            type: string
          required: true
      requestBody:
        description: Informacion del adoptante actualizado
        content:
          application/json:
            schema:
              $ref: '#/paths/~1adoptantes/post/requestBody/content/application~1json/schema'
      responses:
        '200':
          description: Se ha actualizado la informacion del adoptante
          content:
            application/json:
              schema:
                $ref: '#/paths/~1adoptantes/post/requestBody/content/application~1json/schema'
        '400':
          description: Peticion erronea o malformada
        '401':
          description: Usuario no autenticado
        '404':
          description: El adoptante no se encuentra registrado
        '419':
          description: La sesion del usuario ha expirado
    delete:
      summary: Elimina un adoptante registrado
      tags:
        - Adoptante
        - Eliminar
      operationId: eliminarAdoptante
      parameters:
        - name: id_adoptante
          description: Id del adoptante cuya informacion se desea recuperar
          in: path
          schema:
            type: integer
            minimum: 1
            maximum: 999
          required: true
        - name: Token
          description: Token identificador del adoptante loggeado
          in: header
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Se ha eliminado el adoptante indicado
        '400':
          description: Peticion erronea o malformada
        '401':
          description: Usuario no autenticado
        '404':
          description: El adoptante indicado no se encuentra registrado
        '419':
          description: La sesion del usuario ha expirado
  /refugios:
    description: Catalogo de refugios registrados
    get:
      summary: Retorna los refugios que coincidan con algun parametro
      tags:
        - Refugio
      operationId: obtenerRefugios
      parameters:
        - name: nombre
          description: Nombre del refugio
          in: query
          schema:
            type: string
            minLength: 3
            maxLength: 100
          required: false
        - name: estado
          description: Estado donde se ubica el refugio
          in: query
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 32
          required: false
        - name: localidad
          description: Localidad en donde se ubica el refugio
          in: query
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 999
          required: false
      responses:
        '200':
          description: Se ha encontrado por lo menos un refugio que coincide con un criterio
          content:
            application/json:
              schema:
                type: array
                description: Arreglo de refugios
                items:
                  anyOf:
                    - $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema'
                    - $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema'
                    - $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema'
        '204':
          description: No se ha encontrado ninguna coincidencia
        '400':
          description: Peticion erronea o malformada
    post:
      summary: Registra un nuevo refugio
      tags:
        - Refugio
        - Registrar
      operationId: registrarRefugio
      requestBody:
        description: Informacion del refugio que se desea registrar
        content:
          application/json:
            schema:
              type: object
              description: Un refugio para
              required:
                - nombre
              properties:
                id_refugio:
                  description: Identificador del refugio
                  type: integer
                  format: int32
                  minimum: 0
                  maximum: 999
                  example: 62
                nombre:
                  description: Nombre del refugio
                  type: string
                  minLength: 3
                  maxLength: 100
                  example: Refugio patitas
                estado:
                  type: object
                  description: Un estado de la republica
                  required:
                    - id_estado
                  properties:
                    id_estado:
                      description: Identificador del estado
                      type: integer
                      format: int32
                      minimum: 0
                      maximum: 32
                      example: 28
                    estado:
                      description: Nombre del estado
                      type: string
                      minLength: 3
                      maxLength: 50
                      example: Veracruz
                localidad:
                  type: object
                  description: Localidad
                  required:
                    - id_localidad
                  properties:
                    id_localidad:
                      description: Identificador de la localidad
                      type: integer
                      format: int32
                      minimum: 0
                      maximum: 999
                      example: 12
                    localidad:
                      description: Nombre de la localidad
                      type: string
                      minLength: 3
                      maxLength: 150
                      example: Tlanelhuayocan
                direccion:
                  description: Direccion del refugio
                  type: string
                  minLength: 10
                  maxLength: 200
                  example: Calle Huitlacoche
                pagina_web:
                  description: Pagina web del refugio
                  type: string
                  minLength: 5
                  maxLength: 200
                  example: www.refugiopatitas.com
                telefono:
                  description: Numero telefonico
                  type: string
                  minLength: 8
                  maxLength: 14
                  example: 22 91 55 55 55
                email:
                  description: Direccion de correo
                  type: string
                  minLength: 5
                  maxLength: 320
                  example: correo@correo.com
                fundacion:
                  description: Fundacion a la cual pertenece el refugio
                  type: string
                  minLength: 5
                  maxLength: 150
                  example: Ayuda a mastocas en necesidad
        required: true
      responses:
        '201':
          description: Refugio registrado
          content:
            application/json:
              schema:
                $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema'
        '400':
          description: Peticion erronea o malformada
        '409':
          description: El refugio ya ha sido registrado previamente
  '/refugios/{id_refugio}':
    description: Un refugio identificado por su id
    get:
      summary: Retorna la informacion del refugio seleccionado
      tags:
        - Refugio
      operationId: obtenerRefugio
      parameters:
        - name: id_refugio
          description: Id del refugio cuya informacion se desea recuperar
          in: path
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 999
          required: true
        - name: Token
          description: Token identificador del adoptante loggeado
          in: header
          schema:
            type: string
          required: true
      requestBody:
        description: Datos solicitados del refugio
        content:
          application/json:
            schema:
              description: Arreglo con los nombres de las propiedades que se desean retornar
              type: array
              items:
                type: string
              example:
                - id_refugio
                - nombre
                - email
      responses:
        '200':
          description: Se ha retornado la informacion correspondiente al refugio
          content:
            application/json:
              schema:
                $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema'
        '400':
          description: Peticion erronea o malformada
        '401':
          description: Usuario no autenticado
        '404':
          description: El adoptante buscado no se encuentra registrado
        '419':
          description: La sesion del usuario ha expirado
    post:
      summary: Actualiza la informacion de un refugio identificado por su id
      tags:
        - Refugio
        - Actualizar
      operationId: actualizarRefugio
      parameters:
        - name: id_refugio
          description: Id del refugio cuya informacion se desea actualizar
          in: path
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 999
          required: true
        - name: Token
          description: Token identificador del adoptante loggeado
          in: header
          schema:
            type: string
          required: true
      requestBody:
        description: Informacion del refugio actualizada
        content:
          application/json:
            schema:
              $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema'
      responses:
        '200':
          description: Se ha actualizado la informacion del refugio
          content:
            application/json:
              schema:
                $ref: '#/paths/~1refugios/post/requestBody/content/application~1json/schema'
        '400':
          description: Peticion erronea o malformada
        '401':
          description: Usuario no autenticado
        '404':
          description: El adoptante no se encuentra registrado
        '419':
          description: La sesion del usuario ha expirado
    delete:
      summary: Elimina un refugio identificado por su id
      tags:
        - Refugio
        - Eliminar
      operationId: eliminarRefugio
      parameters:
        - name: id_refugio
          description: Id del refugio cuya informacion se desea actualizar
          in: path
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 999
          required: true
        - name: Token
          description: Token identificador del adoptante loggeado
          in: header
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Se ha eliminado el refugio indicado
        '400':
          description: Peticion erronea o malformada
        '401':
          description: Usuario no autenticado
        '404':
          description: El adoptante indicado no se encuentra registrado
        '419':
          description: La sesion del usuario ha expirado
